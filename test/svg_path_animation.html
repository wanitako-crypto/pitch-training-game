<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Path Animation Example</title>
    <style>
        /* --- 全体レイアウト --- */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #1d2630;
            color: #ecf0f1;
            font-family: 'Poppins', sans-serif;
            text-align: center;
            flex-direction: column;
            margin: 0;
        }
        .container {
            width: 200px;
            height: 200px;
            margin-bottom: 2rem;
        }

        /* --- アニメーションのコアとなるCSS --- */
        .path {
            /* 
             * `stroke-dashoffset`プロパティの変化を1秒かけて滑らかに行う。
             * これがアニメーションの肝となる。
             * `stroke-dasharray`はJSで設定するため、ここでは`transition`のみ定義。
            */
            transition: stroke-dashoffset 1s ease-in-out;
        }

        /* --- SVG要素のスタイル --- */
        #circle {
            stroke: #2ecc71; /* 線の色 */
            stroke-width: 8; /* 線の太さ */
            fill: none; /* 塗りつぶしなし */
        }
        #checkmark {
            stroke: #2ecc71;
            stroke-width: 10;
            fill: none;
            stroke-linecap: round; /* 線の端を丸くする */
            stroke-linejoin: round; /* 線の角を丸くする */
            /* チェックマークのアニメーションを0.5秒遅らせて開始する */
            transition-delay: 0.5s;
        }

        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>SVG パスアニメーション</h1>
        <p>線が描画される「ドローイング」エフェクトです。<br>JavaScriptでSVGパスの長さを取得し、CSSでアニメーションさせています。</p>
    </div>

    <div class="container">
        <svg viewBox="0 0 100 100">
            <!-- アニメーションさせる円 -->
            <circle id="circle" class="path" cx="50" cy="50" r="45"/>
            <!-- アニメーションさせるチェックマークのパス -->
            <path id="checkmark" class="path" d="M30 52 l14 14 l28 -28"/>
        </svg>
    </div>

    <button id="replayButton">もう一度再生</button>

    <script>
        // --- DOM要素の取得 ---
        const circle = document.getElementById('circle');
        const checkmark = document.getElementById('checkmark');
        const replayButton = document.getElementById('replayButton');

        /**
         * SVGパスの初期状態（非表示状態）を設定する関数
         * @param {SVGPathElement} pathElement - 対象のSVG要素
         */
        function setupPath(pathElement) {
            // 1. パスの全長を取得する
            const length = pathElement.getTotalLength();
            
            // 2. `stroke-dasharray`にパスの全長を設定する
            //    これにより、パス全体が「1つの長い破線」として扱われる
            pathElement.style.strokeDasharray = length;

            // 3. `stroke-dashoffset`にもパスの全長を設定する
            //    `dashoffset`は破線の開始位置をずらすプロパティ。
            //    全長分ずらすことで、破線（＝実際の線）が見えなくなり、パスが非表示になる。
            pathElement.style.strokeDashoffset = length;
        }

        /**
         * アニメーションを再生する関数
         */
        function playAnimation() {
            // 1. まず各パスを非表示の初期状態に設定する
            setupPath(circle);
            setupPath(checkmark);

            // 2. `setTimeout`を使ってわずかな遅延を発生させる
            //    これにより、ブラウザが非表示のスタイルを確実に描画してから
            //    次のアニメーション開始の指示に移るため、アニメーションが安定して動作する。
            setTimeout(() => {
                // 3. `stroke-dashoffset`を0に戻す
                //    CSSの`transition`プロパティにより、この値の変化が1秒かけて行われる。
                //    オフセットが全長から0に変化する過程で、隠れていた線が徐々に見えてくるため、
                //    描画されているように見える。
                circle.style.strokeDashoffset = '0';
                checkmark.style.strokeDashoffset = '0';
            }, 20); // 20ミリ秒程度のわずかな遅延で十分
        }

        // ページの読み込み完了時にアニメーションを一度再生
        document.addEventListener('DOMContentLoaded', playAnimation);

        // 「もう一度再生」ボタンがクリックされたらアニメーションを再生
        replayButton.addEventListener('click', playAnimation);
    </script>
</body>
</html>
