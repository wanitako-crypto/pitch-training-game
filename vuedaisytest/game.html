<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue.js ゲームデモ</title>
    <!-- daisyUIとTailwind CSSのCDN -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@latest/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue.jsのCDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>

    <div id="app" class="container mx-auto p-8 flex flex-col items-center justify-center min-h-screen">

        <div class="w-full max-w-md text-center">
            
            <h1 class="text-4xl font-bold mb-2">ハイスピード・カウンター</h1>
            <p class="mb-6">制限時間内にどれだけクリックできるかな？</p>

            <!-- ゲームのメイン画面 -->
            <div class="card bg-base-100 shadow-xl p-8">
                
                <!-- スコア表示 -->
                <div class="text-6xl font-black mb-4">{{ score }}</div>

                <!-- 残り時間表示 -->
                <div class="mb-6">
                    <progress class="progress progress-primary w-full" :value="timeLeft" max="10"></progress>
                    <p class="text-sm mt-1">残り時間: {{ timeLeft.toFixed(1) }} 秒</p>
                </div>
                
                <!-- クリックボタン -->
                <!-- `:disabled` の条件を `!isGameActive` に変更。ゲームがアクティブな時だけクリック可能になります。 -->
                <button class="btn btn-primary btn-lg w-full mb-4" @click="incrementScore" :disabled="!isGameActive">
                    クリック！
                </button>
                
                <!-- ゲーム開始/リセットボタン -->
                <!-- `v-if` の条件を `!isGameActive` に変更。ゲーム中でない場合（開始前・終了後）に下のボタンが表示されます。 -->
                <button v-if="!isGameActive" class="btn btn-secondary w-full" @click="startGame">
                    {{ gameStatusMessage }}
                </button>
                <!-- `v-else` で、ゲーム中に「リセット」ボタンを表示します。 -->
                <button v-else class="btn btn-ghost w-full" @click="resetGame">
                    リセット
                </button>
            </div>
            
            <!-- ハイスコア表示 -->
            <div class="mt-6 text-lg">
                <p>ハイスコア: <span class="font-bold">{{ highScore }}</span></p>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, watch } = Vue;

        createApp({
            setup() {
                // --- リアクティブなデータ定義 ---
                const score = ref(0);
                const timeLeft = ref(10.0);
                const highScore = ref(localStorage.getItem('highScore') || 0);
                const isGameActive = ref(false);
                let timer = null;

                // --- 算出プロパティ (Computed Properties) ---
                // ボタンのテキストをゲームの状態に応じて変更します。
                const gameStatusMessage = computed(() => {
                    // `timeLeft`が0ならゲーム終了後なので「もう一度プレイ」
                    if (timeLeft.value <= 0) {
                        return 'もう一度プレイ';
                    }
                    // そうでなければ「ゲーム開始」
                    return 'ゲーム開始';
                });

                // --- メソッド (Methods) ---
                const startGame = () => {
                    // ゲームの状態をリセットしてから開始
                    resetGame();
                    isGameActive.value = true;
                    
                    timer = setInterval(() => {
                        timeLeft.value -= 0.1;
                        if (timeLeft.value <= 0) {
                            endGame();
                        }
                    }, 100);
                };

                const endGame = () => {
                    clearInterval(timer);
                    isGameActive.value = false;
                    timeLeft.value = 0;
                    if (score.value > highScore.value) {
                        highScore.value = score.value;
                        localStorage.setItem('highScore', highScore.value);
                    }
                };
                
                const incrementScore = () => {
                    // ゲームがアクティブな時だけスコアを増やす
                    if (isGameActive.value) {
                        score.value++;
                    }
                };
                
                const resetGame = () => {
                    clearInterval(timer);
                    isGameActive.value = false;
                    score.value = 0;
                    timeLeft.value = 10.0;
                };

                // --- ウォッチャー (Watchers) ---
                watch(isGameActive, (newValue, oldValue) => {
                    console.log(`ゲームの状態が ${oldValue} から ${newValue} に変わりました。`);
                });

                // --- setupの戻り値 ---
                // isGameEndedを削除し、新しいロジックで動作するようにします。
                return {
                    score,
                    timeLeft,
                    highScore,
                    isGameActive,
                    gameStatusMessage,
                    startGame,
                    incrementScore,
                    resetGame
                };
            }
        }).mount('#app');
    </script>

</body>
</html>
